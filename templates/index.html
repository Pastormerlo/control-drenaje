<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mauro Salud</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: -apple-system, sans-serif; }
        .card { border-radius: 12px; border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .stat-val { font-size: 1.5rem; font-weight: bold; }
        .stat-label { font-size: 0.65rem; text-transform: uppercase; color: #6c757d; font-weight: 700; letter-spacing: 0.5px; }
        .seccion-oculta { display: none; }
        .nav-link-custom { color: white; text-decoration: none; font-size: 0.9rem; font-weight: 500; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark bg-primary mb-3 shadow-sm">
    <div class="container">
        <span class="navbar-brand fw-bold">Mauro Salud</span>
        <div><a href="{{ url_for('editar_perfil') }}" class="nav-link-custom me-3">üë§ Ficha</a><a href="{{ url_for('logout') }}" class="btn btn-sm btn-light fw-bold">Salir</a></div>
    </div>
</nav>

<div class="container pb-5">
    <div class="btn-group w-100 mb-3 shadow-sm bg-white rounded">
        <a href="{{ url_for('cargar_registro') }}" class="btn btn-white py-2 {% if modo=='cargar' %}active btn-primary text-white{% endif %}">‚ûï Cargar</a>
        <a href="{{ url_for('ver_registros') }}" class="btn btn-white py-2 {% if modo=='ver' %}active btn-primary text-white{% endif %}">üìä Indicadores</a>
    </div>

    {% if modo == 'perfil' %}
    <div class="card p-4">
        <h5 class="mb-3 fw-bold text-primary">Mi Ficha M√©dica</h5>
        {% with msgs = get_flashed_messages() %}{% if msgs %}<div class="alert alert-success small">{{msgs[0]}}</div>{% endif %}{% endwith %}
        <form action="{{ url_for('editar_perfil') }}" method="POST">
            <div class="row g-3">
                <div class="col-12"><label class="small fw-bold">Nombre</label><input type="text" name="nombre" class="form-control" value="{{perfil.nombre_apellido or ''}}" required></div>
                <div class="col-6"><label class="small fw-bold">Edad</label><input type="number" name="edad" class="form-control" value="{{perfil.edad or ''}}"></div>
                <div class="col-6"><label class="small fw-bold text-danger">Peso (kg)</label><input type="number" step="0.1" name="peso" class="form-control border-danger" value="{{perfil.peso or ''}}"></div>
                <div class="col-12"><label class="small fw-bold">M√©dico</label><input type="text" name="medico" class="form-control" value="{{perfil.nombre_medico or ''}}"></div>
                <div class="col-12"><label class="small fw-bold">Obra Social</label><input type="text" name="obra_social" class="form-control" value="{{perfil.obra_social or ''}}"></div>
                <input type="hidden" name="sexo" value="M">
                <button type="submit" class="btn btn-success w-100 p-3 fw-bold mt-2">üíæ GUARDAR CAMBIOS</button>
            </div>
        </form>
    </div>
    {% endif %}

    {% if modo == 'cargar' %}
    <div class="card p-4">
        <h5 class="mb-3 fw-bold text-primary">Nuevo Registro</h5>
        {% if success %}<div class="alert alert-success small">{{ success }}</div>{% endif %}
        <form action="{{ url_for('cargar_registro') }}" method="POST">
            <div class="row g-3">
                <div class="col-6"><input type="date" name="fecha" class="form-control" id="f_input" required></div>
                <div class="col-6"><input type="time" name="hora" class="form-control" id="h_input" required></div>
                <div class="col-12">
                    <select class="form-select form-select-lg fw-bold" id="tipo_registro" name="tipo_registro" onchange="mostrarCampos()">
                        <option value="presion">‚ù§Ô∏è Presi√≥n</option><option value="glucosa">ü©∏ Glucosa</option><option value="oxigeno">üå¨Ô∏è Ox√≠geno</option><option value="temperatura">üå°Ô∏è Temp</option><option value="drenaje">üíß Drenaje</option>
                    </select>
                </div>
                <div id="campos_presion" class="row g-2 mt-1"><div class="col-4"><input type="number" name="presion_alta" class="form-control" placeholder="Alt"></div><div class="col-4"><input type="number" name="presion_baja" class="form-control" placeholder="Baj"></div><div class="col-4"><input type="number" name="pulso" class="form-control" placeholder="Pul"></div></div>
                <div id="campos_glucosa" class="row g-2 mt-1 seccion-oculta"><div class="col-12"><input type="number" name="glucosa" class="form-control" placeholder="mg/dL"></div></div>
                <div id="campos_oxigeno" class="row g-2 mt-1 seccion-oculta"><div class="col-12"><input type="number" name="oxigeno" class="form-control" placeholder="Sat %"></div></div>
                <div id="campos_temperatura" class="row g-2 mt-1 seccion-oculta"><div class="col-12"><input type="number" step="0.1" name="temperatura" class="form-control" placeholder="¬∞C"></div></div>
                <div id="campos_drenaje" class="row g-2 mt-1 seccion-oculta"><div class="col-6"><input type="number" step="0.1" name="cantidad_izq" class="form-control" placeholder="I (ml)"></div><div class="col-6"><input type="number" step="0.1" name="cantidad_der" class="form-control" placeholder="D (ml)"></div></div>
                <button type="submit" class="btn btn-primary w-100 p-3 fw-bold mt-2">GUARDAR</button>
            </div>
        </form>
    </div>
    <script>
        document.getElementById('f_input').valueAsDate = new Date();
        document.getElementById('h_input').value = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: false});
        function mostrarCampos() {
            const t = document.getElementById('tipo_registro').value;
            ['presion','glucosa','drenaje','oxigeno','temperatura'].forEach(id => document.getElementById('campos_'+id).classList.add('seccion-oculta'));
            document.getElementById('campos_'+t).classList.remove('seccion-oculta');
        }
    </script>
    {% endif %}

    {% if modo == 'ver' %}
    <div class="card p-3 mb-3 bg-light border-0">
        <h6 class="fw-bold small mb-2">üñ®Ô∏è Generar Reporte PDF</h6>
        <form action="{{ url_for('descargar_pdf') }}" method="POST" class="row g-2">
            <div class="col-6">
                <select name="tipo_reporte" class="form-select form-select-sm">
                    <option value="todos">Todo</option>
                    <option value="presion">Presi√≥n</option>
                    <option value="glucosa">Glucosa</option>
                    <option value="oxigeno">Ox√≠geno</option>
                    <option value="temperatura">Temperatura</option>
                    <option value="drenaje">Drenajes</option>
                </select>
            </div>
            <div class="col-6"><select name="periodo" class="form-select form-select-sm"><option value="7">7 d√≠as</option><option value="15">15 d√≠as</option><option value="30" selected>30 d√≠as</option></select></div>
            <button type="submit" class="btn btn-dark w-100 btn-sm fw-bold">DESCARGAR PDF</button>
        </form>
    </div>
    <div class="text-center mb-3"><span class="badge bg-secondary">‚öñÔ∏è Peso: {{stats.peso_actual}} kg</span></div>
    <div class="row g-2 mb-3">
        <div class="col-6"><div class="card p-3 border-start border-danger border-4 h-100"><div class="stat-label">‚ù§Ô∏è Presi√≥n</div><div class="stat-val text-danger">{{stats.presion.prom_a}}/{{stats.presion.prom_b}}</div></div></div>
        <div class="col-6"><div class="card p-3 border-start border-success border-4 h-100"><div class="stat-label">ü©∏ Glucosa</div><div class="stat-val text-success">{{stats.glucosa.prom}}</div></div></div>
        <div class="col-6"><div class="card p-3 border-start border-info border-4 h-100"><div class="stat-label">üå¨Ô∏è Ox√≠geno</div><div class="stat-val text-info">{{stats.oxigeno.prom}}%</div></div></div>
        <div class="col-6"><div class="card p-3 border-start border-warning border-4 h-100"><div class="stat-label">üå°Ô∏è Temp.</div><div class="stat-val text-warning">{{stats.temp.prom}}¬∞</div></div></div>
    </div>
    <button class="btn btn-outline-primary w-100 py-3 fw-bold mb-3 bg-white" type="button" data-bs-toggle="collapse" data-bs-target="#boxHistorial">üìÇ VER HISTORIAL</button>
    <div class="collapse" id="boxHistorial">
        <div class="card overflow-hidden"><div class="table-responsive"><table class="table table-hover mb-0"><tbody style="font-size: 0.8rem;">
            {% for r in registros %}<tr><td class="ps-3"><div>{{r.fecha}}</div><div class="text-muted small">{{r.hora}}</div></td><td class="fw-bold">{{r.tipo[:4]|upper}}</td><td>
                {% if r.tipo == 'presion' %}{{r.presion_alta}}/{{r.presion_baja}}{% elif r.tipo == 'glucosa' %}{{r.glucosa}}{% elif r.tipo == 'drenaje' %}I:{{r.cant_izq}}|D:{{r.cant_der}}{% elif r.tipo == 'oxigeno' %}{{r.oxigeno}}%{% elif r.tipo == 'temperatura' %}{{r.temperatura}}¬∞{% endif %}
            </td><td><a href="{{ url_for('borrar', id=r.id) }}" class="text-danger" onclick="return confirm('¬øBorrar registro?')">üóëÔ∏è</a></td></tr>{% endfor %}
        </tbody></table></div></div>
    </div>
    {% endif %}
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>