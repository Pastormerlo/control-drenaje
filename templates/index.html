<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mauro Salud</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: -apple-system, sans-serif; }
        .card { border-radius: 12px; border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .stat-val { font-size: 1.8rem; font-weight: bold; color: #1a1a1a; }
        .stat-label { font-size: 0.8rem; text-transform: uppercase; color: #6c757d; font-weight: 600; }
        .badge-alert { background-color: #ffe5e5; color: #d90429; font-weight: bold; }
        .seccion-oculta { display: none; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark bg-primary mb-4 shadow-sm">
    <div class="container">
        <span class="navbar-brand fw-bold">Mauro Salud</span>
        <div>
            <a href="{{ url_for('editar_perfil') }}" class="btn btn-sm btn-outline-light">Mi Ficha</a>
            <a href="{{ url_for('logout') }}" class="btn btn-sm btn-light">Salir</a>
        </div>
    </div>
</nav>

<div class="container pb-5">
    <div class="btn-group w-100 mb-4 shadow-sm">
        <a href="{{ url_for('cargar_registro') }}" class="btn btn-white py-2 {% if modo=='cargar' %}active btn-primary text-white{% endif %}">‚ûï Cargar</a>
        <a href="{{ url_for('ver_registros') }}" class="btn btn-white py-2 {% if modo=='ver' %}active btn-primary text-white{% endif %}">üìä Indicadores</a>
    </div>

    {% if modo == 'perfil' %}
    <div class="card p-4">
        <h5 class="mb-4">Mi Ficha Individual</h5>
        {% if get_flashed_messages() %}<div class="alert alert-success">{{ get_flashed_messages()[0] }}</div>{% endif %}
        <form action="{{ url_for('editar_perfil') }}" method="POST">
            <div class="row g-3">
                <div class="col-12"><label class="small fw-bold">Nombre y Apellido</label><input type="text" name="nombre" class="form-control" value="{{perfil.nombre_apellido or ''}}" required></div>
                <div class="col-6"><label class="small fw-bold">Edad</label><input type="number" name="edad" class="form-control" value="{{perfil.edad or ''}}"></div>
                <div class="col-6"><label class="small fw-bold">Sexo</label><select name="sexo" class="form-select"><option value="M" {% if perfil.sexo=='M' %}selected{% endif %}>M</option><option value="F" {% if perfil.sexo=='F' %}selected{% endif %}>F</option></select></div>
                <div class="col-6"><label class="small fw-bold">Peso (kg)</label><input type="number" step="0.1" name="peso" class="form-control" value="{{perfil.peso or ''}}"></div>
                <div class="col-12"><label class="small fw-bold">Obra Social</label><input type="text" name="obra_social" class="form-control" value="{{perfil.obra_social or ''}}"></div>
                <div class="col-12"><label class="small fw-bold">M√©dico de Cabecera</label><input type="text" name="medico" class="form-control" value="{{perfil.nombre_medico or ''}}"></div>
                <button type="submit" class="btn btn-success w-100 p-3 fw-bold">ACTUALIZAR FICHA</button>
            </div>
        </form>
    </div>
    {% endif %}

    {% if modo == 'cargar' %}
    <div class="card p-4">
        <h5 class="mb-4">Nuevo Registro</h5>
        <form action="{{ url_for('cargar_registro') }}" method="POST">
            <div class="row g-3">
                <div class="col-6"><label class="small fw-bold">Fecha</label><input type="date" name="fecha" class="form-control" required id="f_input"></div>
                <div class="col-6"><label class="small fw-bold">Hora</label><input type="time" name="hora" class="form-control" required id="h_input"></div>
                <div class="col-12">
                    <select class="form-select form-select-lg" id="tipo_registro" name="tipo_registro" onchange="mostrarCampos()">
                        <option value="presion">‚ù§Ô∏è Presi√≥n y Pulso</option>
                        <option value="glucosa">ü©∏ Glucosa</option>
                        <option value="drenaje">üíß Drenaje</option>
                        <option value="oxigeno">üå¨Ô∏è Saturaci√≥n O‚ÇÇ</option>
                        <option value="temperatura">üå°Ô∏è Temperatura</option>
                    </select>
                </div>
                <div id="campos_presion" class="row g-2 mt-1">
                    <div class="col-4"><input type="number" name="presion_alta" class="form-control" placeholder="Alta"></div>
                    <div class="col-4"><input type="number" name="presion_baja" class="form-control" placeholder="Baja"></div>
                    <div class="col-4"><input type="number" name="pulso" class="form-control" placeholder="Pulso"></div>
                </div>
                <div id="campos_glucosa" class="row g-2 mt-1 seccion-oculta"><div class="col-12"><input type="number" name="glucosa" class="form-control" placeholder="mg/dL"></div></div>
                <div id="campos_drenaje" class="row g-2 mt-1 seccion-oculta">
                    <div class="col-6"><input type="number" step="0.1" name="cantidad_izq" class="form-control" placeholder="Izq (ml)"></div>
                    <div class="col-6"><input type="number" step="0.1" name="cantidad_der" class="form-control" placeholder="Der (ml)"></div>
                </div>
                <div id="campos_oxigeno" class="row g-2 mt-1 seccion-oculta"><div class="col-12"><input type="number" name="oxigeno" class="form-control" placeholder="Sat %"></div></div>
                <div id="campos_temperatura" class="row g-2 mt-1 seccion-oculta"><div class="col-12"><input type="number" step="0.1" name="temperatura" class="form-control" placeholder="Temp ¬∞C"></div></div>
                <div class="col-12"><textarea name="observaciones" class="form-control" rows="2" placeholder="Notas..."></textarea></div>
                <button type="submit" class="btn btn-primary w-100 p-3 fw-bold mt-3">GUARDAR DATOS</button>
            </div>
        </form>
    </div>
    <script>
        document.getElementById('f_input').valueAsDate = new Date();
        document.getElementById('h_input').value = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: false});
        function mostrarCampos() {
            const t = document.getElementById('tipo_registro').value;
            ['presion','glucosa','drenaje','oxigeno','temperatura'].forEach(id => document.getElementById('campos_'+id).classList.add('seccion-oculta'));
            document.getElementById('campos_'+t).classList.remove('seccion-oculta');
        }
    </script>
    {% endif %}

    {% if modo == 'ver' %}
    <h6 class="stat-label mb-3">Indicadores Clave (30 d√≠as)</h6>
    <div class="row g-3 mb-4">
        <div class="col-12 col-md-6">
            <div class="card p-3 border-start border-success border-4">
                <div class="stat-label">Glucosa Promedio</div>
                <div class="d-flex align-items-baseline">
                    <span class="stat-val">{{stats.glucosa.prom}}</span>
                    <span class="text-muted ms-2">mg/dL</span>
                </div>
                <div class="mt-2 d-flex justify-content-between">
                    <small>M√°x: <strong>{{stats.glucosa.max}}</strong></small>
                    <small>M√≠n: <strong>{{stats.glucosa.min}}</strong></small>
                    <span class="badge badge-alert">{{stats.glucosa.alertas}} alertas</span>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6">
            <div class="card p-3 border-start border-danger border-4">
                <div class="stat-label">Presi√≥n Promedio</div>
                <div class="d-flex align-items-baseline">
                    <span class="stat-val">{{stats.presion.prom_a}}/{{stats.presion.prom_b}}</span>
                    <span class="text-muted ms-2">mmHg</span>
                </div>
                <div class="mt-2 d-flex justify-content-between">
                    <small>Pulso: <strong>{{stats.pulso.prom}} bpm</strong></small>
                    <span class="badge badge-alert">{{stats.presion.alertas}} registros altos</span>
                </div>
            </div>
        </div>
    </div>

    <h6 class="stat-label mb-3">Historial Reciente</h6>
    <div class="card overflow-hidden">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="bg-light">
                    <tr class="small text-muted"><th>FECHA</th><th>TIPO</th><th>VALOR</th><th></th></tr>
                </thead>
                <tbody class="small">
                    {% for r in registros %}
                    <tr>
                        <td>{{r.fecha}}</td>
                        <td class="fw-bold">{{r.tipo.upper()}}</td>
                        <td>
                            {% if r.tipo == 'presion' %}{{r.presion_alta}}/{{r.presion_baja}}
                            {% elif r.tipo == 'glucosa' %}{{r.glucosa}}
                            {% elif r.tipo == 'drenaje' %}{{r.cant_izq or 0}}|{{r.cant_der or 0}}
                            {% elif r.tipo == 'oxigeno' %}{{r.oxigeno}}%
                            {% elif r.tipo == 'temperatura' %}{{r.temperatura}}¬∞
                            {% endif %}
                        </td>
                        <td><a href="{{ url_for('borrar', id=r.id) }}" class="text-danger">üóëÔ∏è</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>
</body>
</html>